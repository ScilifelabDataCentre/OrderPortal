{# Order page. #}

{% block head_title %}Order '{{ order.get('title') or order['_id'] }}'{% end %}
{% block body_title %}Order '{{ order.get('title') or order['_id'] }}'{% end %}

{% extends "base.html" %}

{% block meta_content %}

{% if is_editable %}
<form action="{{ reverse_url('order_edit', order['_id']) }}"
      role="form" method="GET">
  <div class="form-group">
    <button type="submit"
	    class="btn btn-primary glyphicon glyphicon-edit">
      Edit
    </button>
  </div>
</form>

<br>
<form action="{{ reverse_url('order', order['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <div class="form-group">
    <input type="hidden" name="_http_method" value="delete">
    <button type="submit"
	    class="btn btn-danger glyphicon glyphicon-minus"
	    onclick="return confirm('Cannot be undone! Really delete?');">
      Delete
    </button>
  </div>
</form>
{% end %} {# if is_editable #}

{% for target in targets %}
<br>
<form action="{{ reverse_url('order_transition', order['_id'], target['identifier']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-warning">
    {% module Icon(target['identifier']) %}
    {{ target.get('label', target['identifier'].capitalize()) }}
  </button>
</form>
{% end %}

{% end %} {# block meta_content #}

{% block main_content %}
<div class="panel panel-default">
  <div class="panel-body">

    <table class="table table-condensed table-fields table-noborder">
      <tr>
	<th>Owner</th>
	<td colspan="2">
	  <a href="{{ reverse_url('user', order['owner']) }}">
	    {{ order['owner'] }}
	  </a>
	</td>
      </tr>

      <tr>
	<th>Status</th>
	<td>{% module Icon(order['status'], label=True) %}</td>
	<td>{{ status['description'] }}</td>
      </tr>

      <tr>
	<th>Modified</th>
	<td class="localtime">{{ order['modified'] }}</td>
	<td>
	  <a href="{{ reverse_url('order_logs', order['_id']) }}">
	    {% module Icon('logs', label=True) %}
	  </a>
	</td>
      </tr>
    </table>

  </div>
</div>

{# Recursion: 'include' cannot be used! #}
{% module Template('order_fields.html', fields=fields, order=order, is_staff=is_staff) %}

{% end %} {# block main_content #}
