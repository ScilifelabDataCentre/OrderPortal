{# Order edit page. #}

{% extends "base.html" %}

{% block head_title %}
Edit order
'{{ order.get('title') or order['_id'] }}'
{% end %}

{% block body_title %}
Edit order
'{{ order.get('title') or order['_id'] }}'
{% end %}

{% block content %}
<h3 style="padding-left: 4em;">{{ form['title'] }}</h3>

<form action="{{ reverse_url('order', order['_id']) }}"
      class="myForm"
      role="form"
      method="GET">
  <div class="form-group">
    <button type="submit" class="btn btn-default">
      <span class="glyphicon glyphicon-remove"></span>
      Cancel edit
    </button>
  </div>
</form>

<form action="{{ reverse_url('order_edit', order['_id']) }}"
      class="myForm"
      role="form"
      method="POST">
  {% module xsrf_form_html() %}

  {% include 'order_edit_save.html' %}

  <div class="form-group">
    <div class="row">
      <div class="col-md-8">
	<label class="control-label" for="__title__">Title</label>
	<input type="text" class="form-control"
	       name="__title__" id="__title__"
	       value="{{ order.get('title') or '' }}">
      </div>
    </div>
    <span class="help-block">
      Brief, descriptive title for the order. It is not required to
      be unique, but it is a good idea to make it so anyway.
    </span>
  </div>

  <div class="form-group">
    <div class="row">
      <div class="col-md-8">
	<label class="control-label" for="__owner__">Owner</label>
	{% if is_admin %}
	<input type="text" class="form-control"
	       name="__owner__" id="__owner__"
	       value="{{ order['owner'] }}">
	{% else %}
	<select class="form-control" name="__owner__" id="__owner__">
	  {% for colleague in colleagues %}
	    {% set sel = colleague == current_user['email'] and 'selected' or '' %}
	    <option {{ sel }}>{{ colleague }}</option>
	  {% end %}
	</select>
	{% end %}
      </div>
    </div>
    <span class="help-block">
      {% if is_admin %}
      The order's owner specified by email address. May be changed to
      another account.
      {% else %}
      The order's owner may be changed to an account in your groups.
      <strong>NOTE:</strong>
      You will then no longer be able to edit the order.
      {% end %}
    </span>
  </div>

  {# Recursion: 'include' cannot be used! #}
  {% module Template('order_edit_fields.html', fields=fields, order=order, is_staff=is_staff) %}

  {% include 'order_edit_save.html' %}
</form>

<br>
<form action="{{ reverse_url('order', order['_id']) }}"
      class="myForm"
      role="form"
      method="GET">
  <div class="form-group">
    <button type="submit" class="btn btn-default">
      <span class="glyphicon glyphicon-remove"></span>
      Cancel edit
    </button>
  </div>
</form>

{% end %} {# block content #}

{% block header_css %}
<link rel="stylesheet" href="{{ static_url('jquery-ui-themes-1.11.4/themes/smoothness/jquery-ui.min.css') }}">
{% end %}

{% block javascript_code %}
<script src="{{ static_url('field_visible_if.js') }}"></script>
{# This is required for input fields for date. #}
<script src="{{ static_url('jquery-ui-1.11.4/jquery-ui.min.js') }}"></script>
<script src="{{ static_url('quit_through_submit.js') }}"></script>
<script>
  $.datepicker.setDefaults({dateFormat: "yy-mm-dd"});
  $(document).ready(function(){
    $(".datepicker").datepicker();
  });
</script>
{% end %}
