{# Form page. #}

{% extends "base.html" %}

{% block head_title %}Form '{{ form['title'] }}'{% end %}

{% block body_title %}Form '{{ form['title'] }}'{% end %}

{% block meta_content %}

{% if form['status'] == constants.PENDING %}
<br>
<form action="{{ reverse_url('form_enable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-success glyphicon glyphicon-ok"
	  onclick="return confirm('Cannot be undone! Really enable?');">
    Enable
  </button>
</form>

<br>
<form action="{{ reverse_url('form', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <input type="hidden" name="_http_method" value="delete">
  <button type="submit"
	  class="btn btn-danger glyphicon glyphicon-minus"
	  onclick="return confirm('Cannot be undone! Really delete?');">
    Delete
  </button>
</form>

{% elif form['status'] == constants.ENABLED %}
<br>
<form action="{{ reverse_url('form_disable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-danger glyphicon glyphicon-remove">
    Disable
  </button>
</form>

{% elif form['status'] == constants.DISABLED %}
<br>
<form action="{{ reverse_url('form_enable', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit" class="btn btn-success glyphicon glyphicon-ok">
    Enable
  </button>
</form>
{% end %}

<br>
<form action="{{ reverse_url('form_copy', form['_id']) }}"
      role="form" method="POST">
  {% module xsrf_form_html() %}
  <button type="submit"
	  class="btn btn-primary glyphicon glyphicon-plus-sign">
    Copy
  </button>
</form>

{% end %} {# block meta_content #}

{% block main_content %}
<div class="panel panel-default">
  <div class="panel-body">
    <form action="{{ reverse_url('form_edit', form['_id']) }}"
	  role="form" class="panel-form pull-right" method="GET">
      <button type="submit"
	      class="btn btn-xs btn-primary glyphicon glyphicon-edit">
	Edit
      </button>
    </form>
    <table class="table-condensed table-fields">
      <tr>
	<th>Description</th>
	<td>{{ form.get('description') or '' }}</td>
      </tr>

      <tr>
	<th>Status</th>
	<td>{% module Icon(form['status'], label=True) %}</td>
      </tr>

      <tr>
	<th>Modified</th>
	<td>
	  <span class="localtime">{{ form['modified'] }}</span>
	  <a href="{{ reverse_url('form_logs', form['_id']) }}">
	    {% module Icon('logs', label=True) %}
	  </a>
	</td>
      </tr>

      <tr>
	<th>Created</th>
	<td class="localtime">{{ form['created'] }}</td>
      </tr>

    </table>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    Specification fields
    {% if are_fields_editable %}
    <form action="{{ reverse_url('field_create', form['_id']) }}"
	  role="form" class="pull-right" method="GET">
      <button type="submit"
	      class="btn btn-xs btn-primary glyphicon glyphicon-plus">
	Create field
      </button>
    </form>
    {% end %}
  </div>

  <div class="panel-body">

    <table class="table">
      <tr>
	<th>Identifier</th>
	<th>Label</th>
	<th>Type</th>
	<th>Visible</th>
	<th>Required</th>
	<th>Restrictions</th>
	<th>Description</th>
      </tr>
      {% for field in fields %}
      <tr>
	<td class="text-nowrap">
	  {% include 'field_indent.html' %}
	  {% if are_fields_editable %}
	  <a href="{{ reverse_url('field_edit', form['_id'], field['identifier']) }}">
	    {{ field['identifier'] }}
	  </a>
	  {% else %}
	  {{ field['identifier'] }}
	  {% end %}
	</td>
	<td>{{ field.get('label') or '-' }}</td>
	<td>
	  {{ field['type'] }}
	  {% if field['type'] == constants.SELECT %}
	  <pre>{{ '\n'.join(field['select']) }}</pre>
	  {% end %}
	</td>
	<td>
	  {% set identifier = field.get('visible_if_select_field') %}
	  {% if identifier %}
	  if {{ identifier }} == '{{ field.get("visible_if_select_value") }}'
	  {% end %}
	</td>
	<td>
	  {% if field['required'] %}
	  <span class="glyphicon glyphicon-star" style="color: red;">
	  {% elif field['type'] == constants.GROUP %}
	  -
	  {% end %}
	</td>
	<td>
	  {% if field['restrict_read'] %}
	  <span class="glyphicon glyphicon-eye-open" title="Readable by staff only.">
	  {% end %}
	  {% if field['restrict_write'] %}
	  <span class="glyphicon glyphicon-pencil" title="Writeable by admin only.">
	  {% end %}
	</td>
	<td>{{ field.get('description') or '-' }}</td>
      </tr>
      {% end %}
    </table>
  </div>
</div>
{% end %} {# block main_content #}
