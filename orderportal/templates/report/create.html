{# Create a report for an order. #}

{% extends "../base.html" %}

{% block head_title %}
Create a report for {{ terminology('order') }} {{ order['title'] }}
{% end %}

{% block body_title %}
Create a report for {{ terminology('order') }}: {{ order['title'] }}
{% end %}

{% block action_content %}
{% module CancelButton(reverse_url('order', order['_id'])) %}
{% end %} {# block action_content #}

{% block main_content %}
<form action="{{ reverse_url('report_create') }}"
      method="POST" role="form" enctype="multipart/form-data">
  {% module xsrf_form_html() %}
  <input type="hidden" name="order" value="{{ order['_id'] }}">

  <div class="form-group has-feedback">
    <div class="row">
      <div class="col-md-9">
        <label for="report">Report file</label>
        <input type="file" name="report" id="report" class="form-control">
        <span style="color:red; margin-right: 1em;"
              class="glyphicon glyphicon-star form-control-feedback"
              aria-hidden="true"></span>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 help-block">
        The report file to upload. An HTML file will be displayed
        in-line when clicking the link to it; other content types will
        be downloaded as a file.
      </div>
    </div>
  </div>

  <div class="form-group has-feedback">
    <div class="row">
      <div class="col-md-9">
        <label for="report">Responsible</label>
        <input type="text" name="responsible" id="responsible"
               class="form-control" value="{{ current_user['email'] }}">
        <span style="color:red; margin-right: 1em;"
              class="glyphicon glyphicon-star form-control-feedback"
              aria-hidden="true"></span>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 help-block">
        The person responsible for the report. By default the person
        creating the report.
      </div>
    </div>
  </div>

  <div class="form-group">
    <div class="row">
      <div class="col-md-9">
        <label for="reviewers">Request review by</label>
        <textarea name="reviewers" id="reviewers" class="form-control"></textarea>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 help-block">
        <p>
          Request review by the persons given by their email
          addresses, one per line. The report cannot be set as
          published until all reviewers have approved it.
        </p>
        <p>
          Email addresses that do not correspond to currently enabled
          staff accounts in the system will be ignored.
        </p>
        <p>
          If any reviewers are given, the status of the report will be
          set to <strong>Review</strong>.
        </p>
      </div>
    </div>
  </div>

  <div class="form-group">
    <div class="row">
      <div class="col-md-3">
        <label for="status">Status</label>
        <select name="status" id="status" class="form-control">
          {% for status in constants.REPORT_STATUSES %}
          <option value="{{ status }}">{{ status.capitalize() }}</option>
          {% end %}
        </select>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 help-block">
        The status of the report.
        <ul>
          <li>
            <strong>Preparation:</strong> The report is being
            prepared. Use this e.g.  if the report is unfinished, or
            if the reviewers have not been decided.
          </li>
          <li>
            <strong>Review:</strong>The report is being reviewed by
            specified persons. This status will be set if any
            reviewers are given in the field above.
          </li>
          <li>
            <strong>Published:</strong>The report has been published
            and is available to the order owner. If there are
            reviewers, the report must have been approved by all of
            them.
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="form-group">
    <div class="row">
      <div class="col-md-3">
        <label class="control-label"></label>
        <button type="submit" class="btn btn-success btn-block">
          <span class="glyphicon glyphicon-floppy-disk"></span> Save</button>
      </div>
    </div>
  </div>

</form>
{% end %} {# block main_content #}
